# (APPENDIX) Задания {-}

# Задание №1. Отбор точечных объектов {#points-sel-work}

__Цель задания__ — освоение методики автоматизированного отбора точечных объектов на примере населенных пунктов.

Задачи:

1. Изучить принципы, заложенные в методы отбора (исключения) точек _Settlement Spacing_ (прореживание населенных пунктов) и _Voronoy-based_ (взвешенной эффективной площади).
1. Реализовать метод _Settlement Spacing_ на языке программирования Python.
1. Реализовать метод взвешенной эффективной площади на языке программирования Python. Добиться того, чтобы алгоритм не удалял преждевременно самые важные населенные пункты.
1. Реализовать оценку графической нагрузки на языке программирования Python.
1. Подготовить слой населенных пунктов субъекта РФ на основе данных _OpenStreetMap_.
1. Построить модель зависимости условной графической нагрузки от коэффициента масштабирования для метода _Settlement Spacing_ 
1. Осуществить автоматизированный отбор населенных пунктов для масштаба $1:4~000~000$ при графической нагрузке $2$, $4$ и $6$ $см^{-2}$ методом Settlement Spacing.
1. Осуществить аналогичный отбор методом взвешенной эффективной площади, оставив такое же количество населенных пунктов, что и в методе Settlement Spacing.
1. Выполнить численную, графическую и географическую оценку результатов генерализации обоими методами. Сравнить результаты между собой.

## Реализация алгоритма Settlement Spacing {-}

__Входные параметры:__

1. Точечный слой.
2. Поле важности точки.
3. Поле сохранения точки.
4. Масштабирующий коэффициент.

__Входные данные:__
Тестирование инструмента производится на примере слоя `poppnt_ural` (можно вырезать из него небольшой фрагмент из нескольких десятков точек.

__Результат:__
По результатам выполнения инструмента каждой точке в поле сохранения точки должно быть проставлено значение $1$ (оставить) или $0$ (убрать).

## Реализация алгоритма взвешенной эффективной площади {-}

__Входные параметры:__

1. Точечный слой.
2. Поле важности точки.
3. Поле сохранения точки.
4. Доля сохраняемых точек (в %).

__Входные данные:__
Тестирование инструмента производится на примере слоя `poppnt_ural` (можно вырезать из него небольшой фрагмент из нескольких десятков точек.

__Результат:__
По результатам выполнения инструмента каждой точке в поле сохранения точки должно быть проставлено значение $1$ (оставить) или $0$ (убрать).

## Реализация модели оценки условной графической нагрузки {-}

_Условная графическая нагрузка_ – средневзвешенное количество точек на единицу площади, где в качестве веса выступает размер точки, используемый  при ее отображении на карте 

__Входные параметры:__

1. Точечный слой.
2. Поле, отвечающее за графический вес точки (диаметр значка).
3. Пространственное разрешение сетки (в метрах).
4. Выходное поле графической нагрузки

__Требования к входным данным:__

Поле, отвечающее за графический вес точки, должно содержать размеры значков, используемых для визуализации точек. Если значения всех размеров равны $1$, вы получите обычную густоту точек на единицу площади.

__Алгоритм решения задачи:__

1. Построить регулярную сетку с заданным разрешением и охватом, покрывающим входной набор точек с небольшим запасом. Подсказка: вам необходимо построить горизонтальный ограничивающий прямоугольник, буферизовать его на величину разрешения сетки и подать буфер в качестве экстента в инструмент генерации регулярной сетки.

2. Подсчитать суммарный графический вес точек в каждой ячейке и записать результат в новое поле.

3. Сохранить полученную сетку в переменную.

## Отбор населенных пунктов для карты масштаба 1:4 000 000 {-}

В данной — заключительной — части задания необходимо произвести отбор населенных пунктов, используя собственные скрипты, а также произвести графическую оценку полученных результатов.

__Алгоритм выполнения задания:__

1. Скачать данные _OSM_ на территорию Субъекта Федерации. _Не следует_ для выполнения работы брать субъекты с малым числом населенных пунктов (Мурманская область, Еврейская АО, Республика Калмыкия и т.п.).

    > __Внимание__: субъекты у всех студентов должны быть разные!

2. Перепроецировать слой `settlement-points` в наилучшую проекцию для выбранной территории

3. Сформировать поля `Importance` и `Size`, используя следующее отображение атрибутов:

```{r, echo = FALSE, message = FALSE, warning = FALSE}
knitr::kable(readxl::read_excel('tables/pointsel_params.xlsx'))
# rosstat::include_table('tables/pointsel_params.xlsx', caption = 'Параметры заполнения полей')
```

4. Используя фрагмент данных и значения параметра $С$ (Scale) в диапазоне от $1000$ до $10000$ с шагом $1000$, подобрать регрессионную зависимость вида $y = \alpha x^{-\beta}$ между  значением параметра масштабирования $C$ (Scale) и средней графической нагрузкой ($ед.~на~см^2$) в масштабе $1:4~000~000$. Средняя графическая нагрузка оценивается как среднее значение по всем ненулевым ячейкам регулярной сетки. Размер сетки — $1~см^2$ в результирующем масштабе. 

    Найденная зависимость должна иметь примерно следующий вид:

    ```{r, echo = FALSE}
    knitr::include_graphics("slides/OLD/img/talk3/stl-param.png")
    ```

> Внимание: если у вас очень большой или очень маленький субъект федерации, может потребоваться скорректировать шаги. Допустим, для Якутии может оказаться, что целесообразна последовательность от $10000$ до $100000$ с шагом $10000$. Если кривая не выходит экспоненциальной, скорее всего вы работаете не в том диапазоне расстояний, что нужно.

6. Выполнить отбор населенных пунктов с графической нагрузкой $2$, $4$ и $6$ населенных пункта на $см^2$ для масштаба $1:4~000~000$. Соответствующий параметр $C$ (_Scale_) подберите, используя найденную регрессионную зависимость.

> Аналогично: если масштаб 1:4 000 000 для вашего субъекта слишком малый или большой, вы можете его уменьшить или увеличить в 2 раза.

## Оценка полученных результатов {-}

1. Выполнить параметризацию параметра $x$ обобщенного закона _Топфера_ для трёх полученных генерализаций по каждому из двух алгоритмов, исходя из предположения, что отношение результирующего и исходного масштаба равно $1:40$.

2. Построить карты графической нагрузки для обоих алгоритмов.

2. Оформить результаты в виде серии карт, отображающей:
    - границу региона
    - множество исходных точек бледно-серым цветом
    - множество отобранных точек черным цветом соответствующего размера с подписями названий
    - подписи основных населенных пунктов
    - картограмму условной графической нагрузки
  
  Пример серии карт (вы можете упорядочить изображения другим путем — например, по вертикали):
    
```{r, echo = FALSE}
knitr::include_graphics("slides/OLD/img/talk3/mean_density.png")
```

## Отчет {-}

Работа оформляется в виде письменного отчета, в котором необходимо изложить все этапы исследования:

- цель и задачи исследования, 
- суть метода отбора точек, 
- суть принципа оценки условной графической нагрузки, 
- суть обобщенного закона Топфера, 
- процесс разработки инструментов с примерами кода.
- описание эксперимента по генерализации, включая:
    - постановку задачи, 
    - нахождение регрессионной зависимости, 
    - сравнение времени работы модели и скрипта, 
    - выполнение отбора, 
    - оценку результатов в графическом (карты условной нагрузки) и численном (параметризация обобщенного закона Топфера) виде.
    
